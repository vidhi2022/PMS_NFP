<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Create New Project</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
	<style>
		/* Compact form control styling */
		.form-control,
		.form-select {
			padding: 0.25rem 0.4rem !important;
			font-size: 11px !important;
			height: calc(1.5em + 0.6rem + 2px) !important;
		}

		.form-label {
			font-weight: 600;
			font-size: 11px;
			margin-bottom: 4px;
		}

		.btn {
			padding: 0.3rem 0.75rem !important;
			font-size: 11px !important;
		}

		table td,
		table th {
			font-size: 11px;
			padding: 6px;
		}

		h1,
		h2,
		h3,
		h4,
		h5 {
			font-size: 1.25rem;
		}

		.card-header {
			font-size: 14px;
			padding: 0.4rem 0.75rem;
		}

		.card-body {
			padding: 0.75rem 1rem;
		}

		.row.g-3,
		.row.mb-4,
		.row.mb-3 {
			margin-bottom: 0.75rem !important;
			gap: 0.75rem !important;
		}
	</style>
</head>

<body>
	<div class="container py-0">
		<div class="mb-0 text-center">
			<h1 class="text-uppercase text-primary fw-bold">Create New Project</h1>
		</div>
		<form action="success.html" method="GET" enctype="multipart/form-data">
			<!-- Project Information -->
			<div class="card mb-4">
				<div class="card-header bg-light fw-semibold">Project Information</div>
				<div class="card-body">
					<div class="row g-2">
						<div class="col-sm-3">
							<label class="form-label">Project Type</label>
							<select name="owner_dept_cd" class="form-select" required>
								<option value="">-- Select --</option>
								<option value="RNB">New Asset Creation</option>
								<option value="HSG">Upgradation</option>
								<option value="MECH">Maintenance</option>
								<option value="MECH">New Asset and Upgradation</option>
							</select>
						</div>


						<div class="col-sm-3">
							<label class="form-label">Project Name</label>
							<input type="text" name="project_name" class="form-control" required />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Owner Department</label>
							<select name="owner_dept_cd" class="form-select" required>
								<option value="">-- Select Department --</option>
								<option value="RNB">Road & Bridge</option>
								<option value="HSG">Housing</option>
								<option value="MECH">Mechanical</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Division Code</label>
							<select name="division_cd" class="form-select">
								<option value="">-- Select Division --</option>
								<option value="RNB">Div I</option>
								<option value="HSG">Div II</option>
								<option value="MECH">Div III</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Project Start Date</label>
							<input type="date" name="project_start_date" class="form-control" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Project End Date</label>
							<input type="date" name="project_end_date" class="form-control" />
						</div>
						<!-- <div class="col-sm-3">
								<label class="form-label">Project Status Code</label>
								<select name="project_status_cd" class="form-select">
									<option value="">-- Select Status --</option>
									<option value="RNB">In Progress</option>
									<option value="HSG">Completed</option>
									<option value="MECH">Cancelled</option>
								</select>
							</div> -->
						<div class="col-sm-3">
							<label class="form-label">Project Awarded To</label>
							<select name="project_awarded_to" class="form-select">
								<option value="">-- Select Constructor --</option>
								<option value="RNB">M/s K. Nakhro & Sons</option>
								<option value="HSG">M/s LPSS</option>
								<option value="MECH">Naga Construction</option>
							</select>
						</div>


					</div>
				</div>
			</div>

			<!-- Referential Asset Selection -->
			<div class="card mb-4">
				<div class="card-header bg-light fw-semibold">Referential Asset Section</div>
				<div class="card-body">
					<div class="row mb-3">
						<div class="col-sm-12">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="ref_asset" id="rdoRoadWithSubAsset"
									value="existing" checked />
								<label class="form-check-label" for="rdoRoadWithSubAsset">Road and Sub Assets</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="ref_asset" id="rdoSubAsset"
									value="pool" />
								<label class="form-check-label" for="rdoSubAsset">Sub Asset of Asset</label>
							</div>
						</div>
					</div>

					<!-- If Existing Road is selected -->
					<div id="asset_n_sub_asset_fields">
						<div class="row align-items-end">
							<!-- Road Select -->
							<div class="col-sm-2">
								<label class="form-label">Select Road</label>
								<select id="refRoadSelect" class="form-select">
									<option value="">-- Select Road --</option>
									<option value="Rd0001">Rd0001</option>
									<option value="Rd0002">Rd0002</option>
									<option value="Rd0003">Rd0003</option>
								</select>
							</div>
							<!-- Culverts -->
							<div class="col-sm-2">
								<label class="form-label">List of Culverts</label>
								<select id="refCulvertSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Culvert A">Culvert A</option>
									<option value="Culvert B">Culvert B</option>
									<option value="Culvert C">Culvert C</option>
								</select>
							</div>
							<!-- Bridges -->
							<div class="col-sm-2">
								<label class="form-label">List of Bridges</label>
								<select id="refBridgeSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Bridge A">Bridge A</option>
									<option value="Bridge B">Bridge B</option>
									<option value="Bridge C">Bridge C</option>
								</select>
							</div>
							<!-- Retaining Walls -->
							<div class="col-sm-2">
								<label class="form-label">List of Retaining Walls</label>
								<select id="refWallSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Wall A">Wall A</option>
									<option value="Wall B">Wall B</option>
									<option value="Wall C">Wall C</option>
								</select>
							</div>
							<!-- Add Button -->
							<div class="col-sm-2">
								<button type="button" id="addRefAssetBtn" class="btn btn-success w-100">âž•</button>
							</div>
						</div>
						<!-- Table -->
						<div class="table-responsive mt-4">
							<table class="table table-bordered" id="refAssetTable">
								<thead class="table-light">
									<tr>
										<th>Road</th>
										<th>Culverts</th>
										<th>Bridges</th>
										<th>Walls</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody>
									<!-- Rows go here -->
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>


			<!-- Parent Asset Selection -->
			<div class="card mb-4">
				<div class="card-header bg-light fw-semibold">Parent Asset</div>
				<div class="card-body">
					<div class="row mb-3">
						<div class="col-sm-12">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="checkbox" name="parent_asset_type[]"
									id="existingAsset" value="existing" checked />
								<label class="form-check-label" for="existingAsset">Existing Road and Sub Assets</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="checkbox" name="parent_asset_type[]"
									id="assetPool" value="pool" />
								<label class="form-check-label" for="assetPool">From Asset Pool</label>
							</div>
						</div>
					</div>

					<!-- If Existing Road is selected -->
					<div id="existingAssetFields">
						<div class="row align-items-end">
							<!-- Road Select -->
							<div class="col-sm-2">
								<label class="form-label">Select Road</label>
								<select id="roadSelect" class="form-select">
									<option value="">-- Select Road --</option>
									<option value="Rd0001">Rd0001</option>
									<option value="Rd0002">Rd0002</option>
									<option value="Rd0003">Rd0003</option>
								</select>
							</div>
							<!-- Culverts -->
							<div class="col-sm-2">
								<label class="form-label">List of Culverts</label>
								<select id="culvertSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Culvert A">Culvert A</option>
									<option value="Culvert B">Culvert B</option>
									<option value="Culvert C">Culvert C</option>
								</select>
							</div>
							<!-- Bridges -->
							<div class="col-sm-2">
								<label class="form-label">List of Bridges</label>
								<select id="bridgeSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Bridge A">Bridge A</option>
									<option value="Bridge B">Bridge B</option>
									<option value="Bridge C">Bridge C</option>
								</select>
							</div>
							<!-- Retaining Walls -->
							<div class="col-sm-2">
								<label class="form-label">List of Retaining Walls</label>
								<select id="wallSelect" class="form-select">
									<option value="">-- NA--</option>
									<option value="Wall A">Wall A</option>
									<option value="Wall B">Wall B</option>
									<option value="Wall C">Wall C</option>
								</select>
							</div>
							<!-- Add Button -->
							<div class="col-sm-2">
								<button type="button" id="addAssetBtn" class="btn btn-success w-100">âž•</button>
							</div>
						</div>
						<!-- Table -->
						<div class="table-responsive mt-4">
							<table class="table table-bordered" id="assetTable">
								<thead class="table-light">
									<tr>
										<th>Road</th>
										<th>Culverts</th>
										<th>Bridges</th>
										<th>Walls</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody>
									<!-- Rows go here -->
								</tbody>
							</table>
						</div>
					</div>
					<!-- If Asset Pool is selected -->
					<div id="assetPoolFields" style="display: none;">
						<div class="row g-3">
							<div class="col-sm-3">
								<label class="form-label">Select from Asset Pool</label>
								<select name="asset_pool" class="form-select">
									<option value="">-- Select Asset --</option>
									<option value="AP001">Asset Pool 001</option>
									<option value="AP002">Asset Pool 002</option>
									<option value="AP003">Asset Pool 003</option>
								</select>
							</div>
							<div class="col-sm-3 d-flex align-items-end">
								<a href="create-asset-pool.html" class="btn btn-outline-primary">
									âž• Create New Asset Pool
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Site Incharge Details -->
			<div class="card mb-4">
				<div class="card-header bg-light fw-semibold">Site Incharge Details</div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Office</label>
							<select name="site_incharge_office_cd" class="form-select">
								<option value="">-- Select Office --</option>
								<option value="RNB">Site Eng Office1</option>
								<option value="HSG">Site Eng Office2</option>
								<option value="MECH">Site Eng Office3</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Name</label>
							<input type="text" name="site_incharge_name" class="form-control" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Phone No.</label>
							<input type="text" name="site_incharge_ph_no" class="form-control" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Is Published</label>
							<select name="is_published" class="form-select">
								<option value="Y">Yes</option>
								<option value="N">No</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			<!-- Upload Documents -->
			<div class="card mb-4">
				<div class="card-header bg-light fw-semibold">Upload Documents</div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-sm-3">
							<label class="form-label">Upload Project Plan (PDF)</label>
							<input type="file" name="project_plan" class="form-control" accept=".pdf" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Upload Site Images</label>
							<input type="file" name="site_images[]" class="form-control" multiple accept="image/*" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Upload Work Order Document</label>
							<input type="file" name="work_order_doc" class="form-control" accept=".pdf,.doc,.docx" />
						</div>
					</div>
				</div>
			</div>
			<!-- Submit Button -->
			<div class="text-center">
				<button type="submit" class="btn btn-primary px-4">Submit</button>
			</div>
		</form>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		const existingAssetRadio = document.getElementById('existingAsset');
		const assetPoolRadio = document.getElementById('assetPool');
		const existingAssetFields = document.getElementById('existingAssetFields');
		const assetPoolFields = document.getElementById('assetPoolFields');

		function toggleAssetFields() {
			if (existingAssetRadio.checked) {
				existingAssetFields.style.display = 'block';
			} else {
				existingAssetFields.style.display = 'none';
			}

			if (assetPoolRadio.checked) {
				assetPoolFields.style.display = 'block';
			}
			else {
				assetPoolFields.style.display = 'none';
			}
		}

		existingAssetRadio.addEventListener('change', toggleAssetFields);
		assetPoolRadio.addEventListener('change', toggleAssetFields);

		// Call once to set initial visibility
		toggleAssetFields();
	</script>

	<script>
		const assetNSubassetRadio = document.getElementById('rdoRoadWithSubAsset');
		const subAssetRadio = document.getElementById('rdoSubAsset');
		const asset_n_sub_asset_fields = document.getElementById('asset_n_sub_asset_fields');


		function toggleAssetSubAssetFields() {
			if (assetNSubassetRadio.checked) {
				existingAssetFields.style.display = 'block';
			}

			if (subAssetRadio.checked) {
				assetPoolFields.style.display = 'block';
			}
		}

		existingAssetRadio.addEventListener('change', toggleAssetSubAssetFields);
		assetPoolRadio.addEventListener('change', toggleAssetSubAssetFields);

		// Call once to set initial visibility
		toggleAssetFields();

		const addRefAssetBtn = document.getElementById("addRefAssetBtn");
		const refRoadSelect = document.getElementById("refRoadSelect");
		const refCulvertSelect = document.getElementById("refCulvertSelect");
		const refBridgeSelect = document.getElementById("refBridgeSelect");
		const refWallSelect = document.getElementById("refWallSelect");
		const refAssetTableBody = document.querySelector("#refAssetTable tbody");


		addRefAssetBtn.addEventListener("click", () => {
			const road = refRoadSelect.value;
			const culverts = Array.from(refCulvertSelect.selectedOptions).map(opt => opt.value);
			const bridges = Array.from(refBridgeSelect.selectedOptions).map(opt => opt.value);
			const walls = Array.from(refWallSelect.selectedOptions).map(opt => opt.value);

			if (!road || (culverts.length === 0 && bridges.length === 0 && walls.length === 0)) {
				alert("Please select a road and at least one sub-asset.");
				return;
			}

			const tr = document.createElement("tr");

			tr.innerHTML = `<td><input type="hidden" name="roads[]" value="${road}">${road}</td>
													<td>
			      ${culverts.map(c => `<input type="hidden" name="culverts_${road}[]" value="${c}">
															<span class="badge bg-info me-1">${c}</span>`).join('')}
														</td>
														<td>
			      ${bridges.map(b => `														<input type="hidden"
															       name="bridges_${road}[]"
															       value="${b}">
																<span class="badge bg-warning text-dark me-1">${b}</span>`).join('')}
															</td>
															<td>
			      ${walls.map(w => `															<input type="hidden"
																       name="walls_${road}[]"
																       value="${w}">
																	<span class="badge bg-secondary me-1">${w}</span>`).join('')}
																</td>
																<td>
																	<button type="button"
																	        class="btn btn-sm btn-danger deleteRowBtn">Delete</button>
																</td>
			  `;

			refAssetTableBody.appendChild(tr);

			// Reset
			refRoadSelect.selectedIndex = 0;
			refCulvertSelect.selectedIndex = -1;
			refBridgeSelect.selectedIndex = -1;
			refWallSelect.selectedIndex = -1;
		});

		refAssetTableBody.addEventListener("click", function (e) {
			if (e.target.classList.contains("deleteRowBtn")) {
				e.target.closest("tr").remove();
			}
		});
	</script>

	<script>
		const roadSelect = document.getElementById("roadSelect");
		const culvertSelect = document.getElementById("culvertSelect");
		const bridgeSelect = document.getElementById("bridgeSelect");
		const wallSelect = document.getElementById("wallSelect");
		const addAssetBtn = document.getElementById("addAssetBtn");
		const assetTableBody = document.querySelector("#assetTable tbody");

		addAssetBtn.addEventListener("click", () => {
			const road = roadSelect.value;
			const culverts = Array.from(culvertSelect.selectedOptions).map(opt => opt.value);
			const bridges = Array.from(bridgeSelect.selectedOptions).map(opt => opt.value);
			const walls = Array.from(wallSelect.selectedOptions).map(opt => opt.value);

			if (!road || (culverts.length === 0 && bridges.length === 0 && walls.length === 0)) {
				alert("Please select a road and at least one sub-asset.");
				return;
			}

			const tr = document.createElement("tr");

			tr.innerHTML = `<td><input type="hidden" name="roads[]" value="${road}">${road}</td>
													<td>
			      ${culverts.map(c => `<input type="hidden" name="culverts_${road}[]" value="${c}">
															<span class="badge bg-info me-1">${c}</span>`).join('')}
														</td>
														<td>
			      ${bridges.map(b => `														<input type="hidden"
															       name="bridges_${road}[]"
															       value="${b}">
																<span class="badge bg-warning text-dark me-1">${b}</span>`).join('')}
															</td>
															<td>
			      ${walls.map(w => `															<input type="hidden"
																       name="walls_${road}[]"
																       value="${w}">
																	<span class="badge bg-secondary me-1">${w}</span>`).join('')}
																</td>
																<td>
																	<button type="button"
																	        class="btn btn-sm btn-danger deleteRowBtn">Delete</button>
																</td>
			  `;

			assetTableBody.appendChild(tr);

			// Reset
			roadSelect.selectedIndex = 0;
			culvertSelect.selectedIndex = -1;
			bridgeSelect.selectedIndex = -1;
			wallSelect.selectedIndex = -1;
		});

		assetTableBody.addEventListener("click", function (e) {
			if (e.target.classList.contains("deleteRowBtn")) {
				e.target.closest("tr").remove();
			}
		});
	</script>
</body>

</html>