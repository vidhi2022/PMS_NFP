<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Create New Project</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
	<style>
		/* Compact form control styling */
		.form-control,
		.form-select {
			padding: 0.25rem 0.4rem !important;
			font-size: 11px !important;
			/* height: calc(1.5em + 0.6rem + 2px) !important; */
		}

		.form-label {
			font-weight: 600;
			font-size: 11px;
			margin-bottom: 4px;
		}

		.btn {
			padding: 0.3rem 0.75rem !important;
			font-size: 11px !important;
		}

		table td,
		table th {
			font-size: 11px;
			padding: 6px;
		}

		h1,
		h2,
		h3,
		h4,
		h5 {
			font-size: 1.25rem;
		}

		.card-header {
			font-size: 14px;
			padding: 0.4rem 0.75rem;
		}

		.card-body {
			padding: 0.75rem 1rem;
		}

		.row.g-3,
		.row.mb-2,
		.row.mb-3 {
			margin-bottom: 0.75rem !important;
			gap: 0.75rem !important;
		}
	</style>
</head>

<body>
	<div class="container py-0">
		<div class="mb-0 text-center">
			<h1 class="text-uppercase text-primary fw-bold">Create New Project</h1>
		</div>
		<div class="d-flex justify-content-end mb-3">
			<button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#partialProjectsModal">
				<a href="partial-projects.html" class="btn btn-primary btn-sm">📋 View List of Partially Saved
					Projects</a>
			</button>
		</div>
		<form action="success.html" method="GET" enctype="multipart/form-data">
			<!-- Project Information -->
			<div class="card mb-2">
				<div class="card-header bg-light fw-semibold">Project Information</div>
				<div class="card-body">
					<div class="row g-2">
						<div class="col-sm-3">
							<label class="form-label">Project Type</label>
							<select name="projectTypeSelect" id="projectTypeSelect" class="form-select" required>
								<option value="">-- Select --</option>
								<option value="NEW">New Asset Creation</option>
								<option value="UPG">Upgradation</option>
								<option value="MTN">Maintenance</option>
								<option value="NWNUP">New Asset and Upgradation</option>
							</select>
						</div>


						<div class="col-sm-3">
							<label class="form-label">Project Name</label>
							<input type="text" name="project_name" class="form-control" required />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Owner Department</label>
							<select name="owner_dept_cd" class="form-select" required>
								<option value="">-- Select Department --</option>
								<option value="RNB">Road & Bridge</option>
								<option value="HSG">Housing</option>
								<option value="MECH">Mechanical</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Division Code</label>
							<select name="division_cd" class="form-select">
								<option value="">-- Select Division --</option>
								<option value="RNB">Div I</option>
								<option value="HSG">Div II</option>
								<option value="MECH">Div III</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Project Start Date</label>
							<input type="date" name="project_start_date" class="form-control" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Project End Date</label>
							<input type="date" name="project_end_date" class="form-control" />
						</div>

						<div class="col-sm-3">
							<label class="form-label">Project Awarded To</label>
							<select name="project_awarded_to" class="form-select">
								<option value="">-- Select Constructor --</option>
								<option value="RNB">M/s K. Nakhro & Sons</option>
								<option value="HSG">M/s LPSS</option>
								<option value="MECH">Naga Construction</option>
							</select>
						</div>


					</div>
				</div>
			</div>

			<div class="card mb-2" id="referentialAssetSection">
				<div class="card-header bg-light fw-semibold" id="referentialAssetLabel">Referential Asset Section</div>
				<div class="card-body">
					<!-- Radio Buttons -->
					<div class="row mb-3">
						<div class="col-sm-12">
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="ref_asset" id="rdoRoadWithSubAsset"
									value="existing" checked />
								<label class="form-check-label" for="rdoRoadWithSubAsset">Road and Sub Assets</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="ref_asset" id="rdoSubAsset"
									value="pool" />
								<label class="form-check-label" for="rdoSubAsset">Sub Asset of Asset</label>
							</div>
						</div>
					</div>

					<div id="asset_n_sub_asset_fields">
						<!-- Select Fields + Button Row -->
						<div class="row align-items-end">
							<!-- Select Road -->
							<div class="col-sm-2">
								<label class="form-label">Select Road</label>
								<select id="refRoadSelect" class="form-select form-select-sm">
									<option value="">-- Select Road --</option>
									<option value="Rd0001">Rd0001</option>
									<option value="Rd0002">Rd0002</option>
									<option value="Rd0003">Rd0003</option>
								</select>
							</div>
							<!-- Culverts -->
							<div class="col-sm-2">
								<label class="form-label">List of Culverts</label>
								<select id="refCulvertSelect" class="form-control" multiple size="3">
									<option value="">-- NA--</option>
									<option value="Culvert A">Culvert A</option>
									<option value="Culvert B">Culvert B</option>
									<option value="Culvert C">Culvert C</option>
								</select>
							</div>
							<!-- Bridges -->
							<div class="col-sm-2">
								<label class="form-label">List of Bridges</label>
								<select id="refBridgeSelect" class="form-control" multiple size="3">
									<option value="">-- NA--</option>
									<option value="Bridge A">Bridge A</option>
									<option value="Bridge B">Bridge B</option>
									<option value="Bridge C">Bridge C</option>
								</select>
							</div>
							<!-- Retaining Walls -->
							<div class="col-sm-2">
								<label class="form-label">List of Retaining Walls</label>
								<select id="refWallSelect" class="form-control" multiple size="3">
									<option value="">-- NA--</option>
									<option value="Wall A">Wall A</option>
									<option value="Wall B">Wall B</option>
									<option value="Wall C">Wall C</option>
								</select>
							</div>
							<!-- Add Button -->
							<div class="col-sm-1 d-flex justify-content-center align-items-center">
								<button type="button" id="addRefAssetBtn" class="btn btn-success px-3 py-4">➕</button>
							</div>
						</div>

						<!-- Scope Definition -->
						<div class="card mt-4" style="max-width: 700px;">
							<div class="card-header bg-light fw-semibold">Scope Definition</div>
							<div class="card-body">
								<div class="row align-items-end">
									<div class="col-sm-3">
										<label class="form-label">Start Chainage (in KM):</label>
										<input type="text" name="txt_start_chainage" id="txt_start_chainage"
											class="form-control form-control-sm" />
									</div>
									<div class="col-sm-3">
										<label class="form-label">End Chainage (in KM):</label>
										<input type="text" name="txt_end_chainage" id="txt_end_chainage"
											class="form-control form-control-sm" />
									</div>
								</div>
							</div>
						</div>

						<!-- Table -->
						<div class="table-responsive mt-4">
							<table class="table table-bordered" id="refAssetTable">
								<thead class="table-light">
									<tr>
										<th>Road</th>
										<th>Start Chainage</th>
										<th>End Chainage</th>
										<th>Culverts</th>
										<th>Bridges</th>
										<th>Walls</th>
										<th>Action</th>
									</tr>
								</thead>
								<tbody>
									<!-- Dynamic Rows -->
								</tbody>
							</table>
						</div>

						<div class="col-md-3" id="shapeFileUploadContainer">
							<label class="form-label fw-bold">Upload Road Shape File</label>
							<input type="file" class="form-control form-control-sm" name="road_shapefile" accept=".shp">
						</div>
					</div>
				</div>
			</div>


			<div class="card mb-2" id="newAssetUpgradeSection" style="display: none;">
				<div class="card-header bg-light fw-semibold">Referential Asset Section</div>
				<div class="card-body">
					<div class="row g-3 mb-2">
						<div class="col-md-3">
							<label class="form-label fw-bold">Select Roads</label>
							<select class="form-select" id="refUpgradeRoads" multiple size="4">
								<option value="RD001">Road A</option>
								<option value="RD002">Road B</option>
								<option value="RD003">Road C</option>
							</select>
						</div>

						<!-- Scope Definition -->
						<div class="col-md-6">
							<div class="card mt-3" style="max-width: 400px;">
								<div class="card-header bg-light fw-semibold">Scope Definition</div>
								<div class="card-body">
									<div class="row align-items-end">
										<div class="col-sm-4">
											<label class="form-label fw-bold">Start Chainage (in KM)</label>
											<input type="text" id="upgrade_start_chainage"
												class="form-control form-control-sm">
										</div>
										<div class="col-sm-4">
											<label class="form-label fw-bold">End Chainage (in KM)</label>
											<input type="text" id="upgrade_end_chainage"
												class="form-control form-control-sm">
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-3">
							<button type="button" class="btn btn-success btn-sm " onclick="addUpgradeScope()">
								+ Add to Table
							</button>
						</div>
					</div>


					<!-- Scope Table -->
					<div class="table-responsive mt-4">
						<table class="table table-bordered" id="upgradeScopeTable">
							<thead class="table-light">
								<tr>
									<th>Road(s)</th>
									<th>Start Chainage</th>
									<th>End Chainage</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>

					<div class="col-md-3" id="shapeFileUploadContainer">
						<label class="form-label fw-bold">Upload Road Shape File</label>
						<input type="file" class="form-control form-control-sm" name="road_shapefile" accept=".shp">
					</div>
				</div>
			</div>

			<div class="card mb-2" id="upgradeSubAssetSection" style="display: none;">
				<div id="newUpSubAssetTitle" class="card-header bg-light fw-semibold">
					Add Sub Assets
				</div>
				<div class="card-body">


					<div class="row g-3 mb-3">
						<div class="col-md-4">
							<label class="form-label fw-bold">Culverts</label>
							<select multiple class="form-select" size="5" id="upgradeCulverts">
								<option value="CUL001">Upgrade Culvert A</option>
								<option value="CUL002">Upgrade Culvert B</option>
								<option value="CUL003">Upgrade Culvert C</option>
							</select>
						</div>
						<div class="col-md-4">
							<label class="form-label fw-bold">Bridges</label>
							<select multiple class="form-select" size="5" id="upgradeBridges">
								<option value="BR001">Upgrade Bridge A</option>
								<option value="BR002">Upgrade Bridge B</option>
							</select>
						</div>
						<div class="col-md-4">
							<label class="form-label fw-bold">Retaining Walls</label>
							<select multiple class="form-select" size="5" id="upgradeWalls">
								<option value="RW001">Upgrade Wall A</option>
								<option value="RW002">Upgrade Wall B</option>
							</select>
						</div>
					</div>

					<div class="row">
						<div class="col-md-3">
							<button type="button" class="btn btn-success btn-sm w-100" onclick="addUpgradeSubAssets()">+
								Add Sub
								Assets</button>
						</div>
					</div>

					<div class="table-responsive mt-4">
						<table class="table table-bordered" id="upgradeSubAssetTable">
							<thead class="table-light">
								<tr>
									<th>Culverts</th>
									<th>Bridges</th>
									<th>Retaining Walls</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="card mb-2" id="maintenanceSection" style="display: none;">
				<div class="card-header bg-light fw-semibold">Select Asset for Maintenance</div>
				<div class="card-body">
					<div class="row g-3 mb-2">
						<div class="col-md-3">
							<label class="form-label fw-bold">Select Roads</label>
							<select class="form-select" id="maintRoads" multiple size="4">
								<option value="RD001">Due Maintanence Road 001</option>
								<option value="RD002">Due Maintanence Road 002</option>
							</select>
						</div>
						<div class="col-md-3">
							<label class="form-label fw-bold">Select Culverts</label>
							<select class="form-select" id="maintCulverts" multiple size="4">
								<option value="CUL001">Due Maintanence Culvert A</option>
								<option value="CUL002">Due Maintanence Culvert B</option>
							</select>
						</div>
						<div class="col-md-3">
							<label class="form-label fw-bold">Select Bridges</label>
							<select class="form-select" id="maintBridges" multiple size="4">
								<option value="BR001">Due Maintanence Bridge A</option>
								<option value="BR002">Due Maintanence Bridge B</option>
							</select>
						</div>
						<div class="col-md-3">
							<label class="form-label fw-bold">Select Retaining Walls</label>
							<select class="form-select" id="maintWalls" multiple size="4">
								<option value="RW001">Due Maintanence Wall A</option>
								<option value="RW002">Due Maintanence Wall B</option>
							</select>
						</div>
						<!-- Scope Definition -->
						<div class="card mt-4" style="max-width: 700px;">
							<div class="card-header bg-light fw-semibold">Scope Definition</div>
							<div class="card-body">
								<div class="row align-items-end">
									<div class="col-sm-3">
										<label class="form-label">Start Chainage (in KM):</label>
										<input type="text" name="txt_start_chainage_mnt" id="txt_start_chainage_mnt"
											class="form-control form-control-sm" />
									</div>
									<div class="col-sm-3">
										<label class="form-label">End Chainage (in KM):</label>
										<input type="text" name="txt_end_chainage_mnt" id="txt_end_chainage_mnt"
											class="form-control form-control-sm" />
									</div>
								</div>
							</div>
						</div>
					</div>
					<button type="button" class="btn btn-sm btn-success" onclick="addMaintenanceAssets()">+ Add to
						Table</button>

					<div class="table-responsive mt-4">
						<table class="table table-bordered" id="mtnAssetTable">
							<thead class="table-light">
								<tr>
									<th>Road(s)</th>
									<th>Start Chainage</th>
									<th>End Chainage</th>
									<th>Culverts</th>
									<th>Bridges</th>
									<th>Walls</th>
									<th>Action</th>
								</tr>
							</thead>
							<tbody>
								<!-- Dynamic Rows -->
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Parent Asset Selection -->
			<div class="card mb-2" id="assetPoolSection">
				<div class="card-header bg-light fw-semibold">Asset Pool Section</div>
				<div class="card-body">
					<div class="row mb-3">
						<div class="col-sm-12">
							<!-- <div class="form-check form-check-inline">
								<input class="form-check-input" type="checkbox" name="parent_asset_type[]"
									id="existingAsset" value="existing" checked />
								<label class="form-check-label" for="existingAsset">Existing Road and Sub Assets</label>
							</div> -->
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="checkbox" name="parent_asset_type[]"
									id="assetPool" value="pool" />
								<label class="form-check-label" for="assetPool">Create New Asset From Asset Pool</label>
							</div>
						</div>
					</div>

					<!-- If Existing Road is selected -->

					<!-- If Asset Pool is selected -->
					<div id="assetPoolFields" style="display: none;">
						<div class="row g-3">
							<div class="col-sm-3">
								<label class="form-label">Select from Asset Pool</label>
								<select name="asset_pool" class="form-select">
									<option value="">-- Select Asset --</option>
									<option value="AP001">Asset Pool 001</option>
									<option value="AP002">Asset Pool 002</option>
									<option value="AP003">Asset Pool 003</option>
								</select>
							</div>
							<div class="col-sm-3 d-flex align-items-end">
								<a href="create-asset-pool.html" class="btn btn-outline-primary">
									➕ Create New Asset Pool
								</a>
							</div>
						</div>
					</div>
				</div>

				<div class="col-sm-12 mt-3" id="assetPoolDetails" style="display: none;">
					<div class="card">
						<div class="card-header bg-info text-white fw-bold">Selected Asset Pool Details</div>
						<div class="card-body p-2" id="assetPoolDetailsContent">
							<!-- Dynamic content will be injected here -->
						</div>
					</div>
				</div>
			</div>


			<!-- Site Incharge Details -->
			<div class="card mb-2">
				<div class="card-header bg-light fw-semibold">Site Incharge Details</div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Office</label>
							<select name="site_incharge_office_cd" class="form-select">
								<option value="">-- Select Office --</option>
								<option value="RNB">Site Eng Office1</option>
								<option value="HSG">Site Eng Office2</option>
								<option value="MECH">Site Eng Office3</option>
							</select>
						</div>
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Name</label>
							<input type="text" name="site_incharge_name" class="form-control" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Site Incharge Phone No.</label>
							<input type="text" name="site_incharge_ph_no" class="form-control" />
						</div>
					</div>
				</div>
			</div>


			<!-- Item Of Work Section -->
			<div class="card mb-2">
				<div class="card-header bg-light fw-semibold">
					Add Items of Work
				</div>
				<div class="card-body">
					<!-- Input Row -->
					<div class="row g-3 align-items-end">
						<!-- Item of Work Select -->
						<div class="col-md-3">
							<label class="form-label">Item of Work</label>
							<select id="workItemSelect" class="form-select form-select-sm">
								<option value="">-- Select Item --</option>
								<option>1000 hp</option>
								<option>750 hp</option>
								<option>Box culvert</option>
								<option>Breast wall</option>
								<option>Earthwork</option>
								<option>FDR</option>
								<option>MSS</option>
								<option>Payment</option>
								<option>PCC</option>
								<option>RCC Culvert</option>
								<option>Retaining wall</option>
								<option>WBM I</option>
								<option>WBM II</option>
							</select>
						</div>
						<!-- Quantity Input -->
						<div class="col-md-3">
							<label class="form-label">Quantity As Per DPR</label>
							<input type="number" id="workQtyInput" class="form-control form-control-sm"
								placeholder="Enter quantity" min="0" step="any" />
						</div>
						<!-- Add Button -->
						<div class="col-md-2">
							<button type="button" id="addWorkItemBtn" class="btn btn-success btn-sm w-100">➕
								Add</button>
						</div>
					</div>

					<!-- Table of Added Items -->
					<div class="table-responsive mt-3">
						<table class="table table-bordered table-sm" id="workItemsTable">
							<thead class="table-light">
								<tr>
									<th>Item of Work</th>
									<th>Quantity As Per DPR</th>
									<th style="width:60px;">Action</th>
								</tr>
							</thead>
							<tbody>
								<!-- rows inserted here -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<!-- Upload Documents -->
			<div class="card mb-2">
				<div class="card-header bg-light fw-semibold">
					Upload Documents
				</div>
				<div class="card-body">
					<div class="row g-2">
						<div class="col-sm-3">
							<label class="form-label">Upload Project Plan (PDF)</label>
							<input type="file" name="project_plan" class="form-control" accept=".pdf" />
						</div>
						<div class="col-sm-3">
							<label for="dprUpload" class="form-label fw-bold">Upload DPR Document (PDF/Excel)</label>
							<input type="file" class="form-control form-control-sm" id="dprUpload" name="dpr_document"
								accept=".pdf, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
						</div>
						<div class="col-sm-3">
							<label class="form-label">Upload Site Images</label>
							<input type="file" name="site_images[]" class="form-control" multiple accept="image/*" />
						</div>
						<div class="col-sm-3">
							<label class="form-label">Upload Work Order Document(pdf/doc/docx)</label>
							<input type="file" name="work_order_doc" class="form-control" accept=".pdf,.doc,.docx" />
						</div>
					</div>
				</div>
			</div>

			<div class="row g-3">
				<div class="col-sm-3 text-center">

				</div>
				<div class="col-sm-2 text-center">
					<button type="button" class="btn btn-primary px-4" onclick="savePartial()">Save</button>
				</div>
				<div class="col-sm-2 text-center">
					<button type="button" class="btn btn-primary px-4">Cancel</button>
				</div>
				<!-- Submit Button -->
				<div class="col-sm-2 text-center">
					<button type="submit" class="btn btn-primary px-4">Submit</button>
				</div>
				<div class="col-sm-3 text-center">

				</div>
			</div>

		</form>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>

		// Add Scope Entries to Table
		function addUpgradeScope() {
			const roads = Array.from(document.getElementById('refUpgradeRoads').selectedOptions)
				.map(opt => opt.text).join(', ');
			const start = document.getElementById('upgrade_start_chainage').value.trim();
			const end = document.getElementById('upgrade_end_chainage').value.trim();

			if (!roads || !start || !end) {
				alert('Please select roads and enter both start and end chainage.');
				return;
			}

			const row = document.createElement('tr');
			row.innerHTML = `
							<td>${roads}</td>
							<td>${start}</td>
							<td>${end}</td>
							<td><button class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()">Delete</button></td>
							`;
			document.querySelector('#upgradeScopeTable tbody').appendChild(row);

			// Clear inputs
			document.getElementById('upgrade_start_chainage').value = '';
			document.getElementById('upgrade_end_chainage').value = '';
			document.getElementById('refUpgradeRoads').selectedIndex = -1;
		}

		function addUpgradeSubAssets() {
			// const road = document.getElementById('upgradeSubAssetRoad').value;

			const culverts = Array.from(document.getElementById('upgradeCulverts').selectedOptions).map(opt => opt.text).join(', ');
			const bridges = Array.from(document.getElementById('upgradeBridges').selectedOptions).map(opt => opt.text).join(', ');
			const walls = Array.from(document.getElementById('upgradeWalls').selectedOptions).map(opt => opt.text).join(', ');

			const row = document.createElement('tr');
			row.innerHTML = `

							<td>${culverts}</td>
							<td>${bridges}</td>
							<td>${walls}</td>
							<td><button class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()">Delete</button></td>
							`;
			document.querySelector('#upgradeSubAssetTable tbody').appendChild(row);

			// Optional: Clear selections
			document.getElementById('upgradeSubAssetRoad').value = '';
			document.getElementById('upgradeCulverts').selectedIndex = -1;
			document.getElementById('upgradeBridges').selectedIndex = -1;
			document.getElementById('upgradeWalls').selectedIndex = -1;
		}
	</script>


	<script>
		const projectTypeSelect = document.getElementById("projectTypeSelect");
		const referentialSection = document.getElementById("referentialAssetSection");
		const referentialLabel = document.getElementById("referentialAssetLabel");
		const assetPoolSection = document.getElementById("assetPoolSection");
		const maintenanceSection = document.getElementById("maintenanceSection");
		const newAssetUpgradeSection = document.getElementById("newAssetUpgradeSection");
		const upgradeSubAssetSection = document.getElementById("upgradeSubAssetSection");

		function toggleSectionsBasedOnProjectType() {
			const selected = projectTypeSelect.value;

			if (selected === "NEW") { // New Asset Creation
				referentialSection.style.display = "none";
				assetPoolSection.style.display = "block";
				maintenanceSection.style.display = "none";
				newAssetUpgradeSection.style.display = "none";
				upgradeSubAssetSection.style.display = "none";
				referentialLabel.textContent = "Referential Asset Section";
			} else if (selected === "UPG") { // Upgradation
				referentialSection.style.display = "block";
				assetPoolSection.style.display = "none";
				maintenanceSection.style.display = "none";
				newAssetUpgradeSection.style.display = "none";
				upgradeSubAssetSection.style.display = "none";
				referentialLabel.textContent = "Select Asset for Upgradation";
			} else if (selected === "MTN") { // Maintenance
				referentialSection.style.display = "none";
				assetPoolSection.style.display = "none";
				maintenanceSection.style.display = "block";
				newAssetUpgradeSection.style.display = "none";
				upgradeSubAssetSection.style.display = "none";
			}
			else if (selected === "NWNUP") {
				newAssetUpgradeSection.style.display = "block";
				upgradeSubAssetSection.style.display = "block";
				referentialSection.style.display = "none";
				maintenanceSection.style.display = "none";
				assetPoolSection.style.display = "block";
			}
			else {
				referentialSection.style.display = "block";
				assetPoolSection.style.display = "block";
				maintenanceSection.style.display = "block";
				newAssetUpgradeSection.style.display = "block";
				upgradeSubAssetSection.style.display = "block";
				referentialLabel.textContent = "Referential Asset Section";
			}
		}

		projectTypeSelect.addEventListener("change", toggleSectionsBasedOnProjectType);
		toggleSectionsBasedOnProjectType(); // Initial check
	</script>

	<script>
		function addMaintenanceAssets() {
			const getSelectedValues = (selectId) => {
				const options = document.getElementById(selectId).selectedOptions;
				return Array.from(options).map(opt => opt.text).join(', ');
			};

			const roads = getSelectedValues('maintRoads');
			const culverts = getSelectedValues('maintCulverts');
			const bridges = getSelectedValues('maintBridges');
			const walls = getSelectedValues('maintWalls');

			const startChainage = document.getElementById('txt_start_chainage_mnt').value.trim();
			const endChainage = document.getElementById('txt_end_chainage_mnt').value.trim();

			if (!roads && !culverts && !bridges && !walls) {
				alert("Please select at least one asset.");
				return;
			}

			const tableBody = document.querySelector('#mtnAssetTable tbody');
			const newRow = document.createElement('tr');

			newRow.innerHTML = `
								<td>${roads || '-'}</td>
								<td>${startChainage || '-'}</td>
								<td>${endChainage || '-'}</td>
								<td>${culverts || '-'}</td>
								<td>${bridges || '-'}</td>
								<td>${walls || '-'}</td>
								<td><button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()">Delete</button></td>
								`;

			tableBody.appendChild(newRow);

			// Optional: Clear fields after adding
			document.getElementById('txt_start_chainage_mnt').value = '';
			document.getElementById('txt_end_chainage_mnt').value = '';
			['maintRoads', 'maintCulverts', 'maintBridges', 'maintWalls'].forEach(id => {
				document.getElementById(id).selectedIndex = -1;
			});
		}
	</script>


	<script>
		function savePartial() {
			// Simulate generating a project number
			const projectNo = "PRJ20250030";

			// Optional: Store data to localStorage or backend here

			// Redirect to success page with project number in query string
			window.location.href = `partial-save-success.html?projectNo=${projectNo}`;
		}
	</script>
	<script>
		// Grab elements
		const workSelect = document.getElementById('workItemSelect');
		const qtyInput = document.getElementById('workQtyInput');
		const addBtn = document.getElementById('addWorkItemBtn');
		const tableBody = document.querySelector('#workItemsTable tbody');

		addBtn.addEventListener('click', () => {
			const item = workSelect.value;
			const qty = qtyInput.value.trim();

			if (!item) {
				return alert('Please select an Item of Work.');
			}
			if (!qty || isNaN(qty) || Number(qty) <= 0) {
				return alert('Please enter a valid quantity.');
			}

			// Create row
			const tr = document.createElement('tr');
			tr.innerHTML = `
							<td>
							<input type="hidden" name="work_items[]" value="${item}">
							${item}
							</td>
							<td>
							<input type="hidden" name="work_qtys[]" value="${qty}">
							${qty}
							</td>
							<td class="text-center">
							<button type="button" class="btn btn-sm btn-danger deleteRowBtn">❌</button>
							</td>
						`;
			tableBody.appendChild(tr);

			// Reset inputs
			workSelect.selectedIndex = 0;
			qtyInput.value = '';
		});

		// Delegate delete
		tableBody.addEventListener('click', ev => {
			if (ev.target.classList.contains('deleteRowBtn')) {
				ev.target.closest('tr').remove();
			}
		});
	</script>
	<script>
		const existingAssetRadio = document.getElementById('existingAsset');
		const assetPoolRadio = document.getElementById('assetPool');
		const existingAssetFields = document.getElementById('existingAssetFields');
		const assetPoolFields = document.getElementById('assetPoolFields');

		function toggleAssetFields() {
			if (assetPoolRadio.checked) {
				assetPoolFields.style.display = 'block';
			}
			else {
				assetPoolFields.style.display = 'none';
			}
		}


		assetPoolRadio.addEventListener('change', toggleAssetFields);

		toggleAssetFields();


	</script>

	<script>
		const assetNSubassetRadio = document.getElementById('rdoRoadWithSubAsset');
		const subAssetRadio = document.getElementById('rdoSubAsset');
		const asset_n_sub_asset_fields = document.getElementById('asset_n_sub_asset_fields');

		const shapeFileDiv = document.getElementById("shapeFileUploadContainer");

		function toggleAssetSubAssetFields() {
			if (assetNSubassetRadio.checked) {
				shapeFileDiv.style.display = "block";
			}

			if (subAssetRadio.checked) {
				assetPoolFields.style.display = 'block';
				shapeFileDiv.style.display = "none";
			}
		}

		assetNSubassetRadio.addEventListener('change', toggleAssetSubAssetFields);
		subAssetRadio.addEventListener('change', toggleAssetSubAssetFields);

		// Call once to set initial visibility
		toggleAssetSubAssetFields();

		const addRefAssetBtn = document.getElementById("addRefAssetBtn");
		const refRoadSelect = document.getElementById("refRoadSelect");
		const refCulvertSelect = document.getElementById("refCulvertSelect");
		const refBridgeSelect = document.getElementById("refBridgeSelect");
		const refWallSelect = document.getElementById("refWallSelect");
		const txt_start_chainage = document.getElementById("txt_start_chainage");
		const txt_end_chainage = document.getElementById("txt_end_chainage");

		const refAssetTableBody = document.querySelector("#refAssetTable tbody");

		addRefAssetBtn.addEventListener("click", () => {
			const road = refRoadSelect.value;
			const culverts = Array.from(refCulvertSelect.selectedOptions).map(opt => opt.value);
			const bridges = Array.from(refBridgeSelect.selectedOptions).map(opt => opt.value);
			const walls = Array.from(refWallSelect.selectedOptions).map(opt => opt.value);
			const startChainage = txt_start_chainage.value.trim();
			const endChainage = txt_end_chainage.value.trim();

			if (!road || !startChainage || !endChainage) {
				alert("Please select a road, enter chainage.");
				return;
			}

			const tr = document.createElement("tr");

			tr.innerHTML = `
							<td>
							<input type="hidden" name="roads[]" value="${road}">${road}
							</td>
							<td>
							<input type="hidden" name="start_chainage_${road}" value="${startChainage}">${startChainage}
							</td>
							<td>
							<input type="hidden" name="end_chainage_${road}" value="${endChainage}">${endChainage}
							</td>
							<td>
							${culverts.map(c => `<input type="hidden" name="culverts_${road}[]" value="${c}">
							<span class="badge bg-info me-1">${c}</span>`).join('')}
							</td>
							<td>
							${bridges.map(b => `<input type="hidden" name="bridges_${road}[]" value="${b}">
							<span class="badge bg-warning text-dark me-1">${b}</span>`).join('')}
							</td>
							<td>
							${walls.map(w => `<input type="hidden" name="walls_${road}[]" value="${w}">
							<span class="badge bg-secondary me-1">${w}</span>`).join('')}
							</td>
							<td>
							<button type="button" class="btn btn-sm btn-danger deleteRowBtn">Delete</button>
							</td>
						`;

			refAssetTableBody.appendChild(tr);

			// Reset form inputs
			refRoadSelect.selectedIndex = 0;
			refCulvertSelect.selectedIndex = -1;
			refBridgeSelect.selectedIndex = -1;
			refWallSelect.selectedIndex = -1;
			txt_start_chainage.value = "";
			txt_end_chainage.value = "";
		});

		refAssetTableBody.addEventListener("click", function (e) {
			if (e.target.classList.contains("deleteRowBtn")) {
				e.target.closest("tr").remove();
			}
		});

	</script>

	<script>
		const roadSelect = document.getElementById("roadSelect");
		const culvertSelect = document.getElementById("culvertSelect");
		const bridgeSelect = document.getElementById("bridgeSelect");
		const wallSelect = document.getElementById("wallSelect");
		const addAssetBtn = document.getElementById("addAssetBtn");
		const assetTableBody = document.querySelector("#assetTable tbody");


	</script>


	<script>
		const assetPools = {
			AP001: {
				road: 'Proposed Road A',
				length: '12.5 km',
				category: 'National Highway',
				type: 'Flexible',
				owner: 'PWD',
				culverts: ['Culvert A1', 'Culvert A2'],
				bridges: ['Proposed Bridge A'],
				walls: ['Wall A1'],
				shapefile: 'roadA.shp'
			},
			AP002: {
				road: 'Proposed Road B',
				length: '7.2 km',
				category: 'State Highway',
				type: 'Rigid',
				owner: 'R&B Dept',
				culverts: ['Proposed Culvert B1'],
				bridges: [],
				walls: ['Wall B1', 'Wall B2'],
				shapefile: 'roadB.shp'
			}
		};

		const assetPoolDropdown = document.querySelector('select[name="asset_pool"]');
		const assetPoolDetailsSection = document.getElementById("assetPoolDetails");
		const assetPoolDetailsContent = document.getElementById("assetPoolDetailsContent");

		assetPoolDropdown.addEventListener("change", () => {
			const selectedId = assetPoolDropdown.value;
			if (assetPools[selectedId]) {
				const data = assetPools[selectedId];
				assetPoolDetailsSection.style.display = 'block';
				assetPoolDetailsContent.innerHTML = `
													<p><strong>Road Name:</strong> ${data.road}</p>
													<p><strong>Length:</strong> ${data.length}</p>
													<p><strong>Category:</strong> ${data.category}</p>
													<p><strong>Type:</strong> ${data.type}</p>
													<p><strong>Owner:</strong> ${data.owner}</p>
													<p><strong>Shapefile:</strong> ${data.shapefile}</p>
													<p><strong>Culverts:</strong> ${data.culverts.join(', ')}</p>
													<p><strong>Bridges:</strong> ${data.bridges.join(', ')}</p>
													<p><strong>Retaining Walls:</strong> ${data.walls.join(', ')}</p>
												`;
			} else {
				assetPoolDetailsSection.style.display = 'none';
				assetPoolDetailsContent.innerHTML = '';
			}
		});
	</script>

	<script>
		function getQueryParam(param) {
			const params = new URLSearchParams(window.location.search);
			return params.get(param);
		}

		const dummyProjects = {
			PRJ20250001: {
				project_name: "Bridge Upgradation PRJ20250001",
				owner_dept_cd: "HSG",
				division_cd: "Div I",
				project_start_date: "2025-08-01",
				project_end_date: "2026-01-01",
				project_awarded_to: "HSG"
			},
			PRJ20250002: {
				project_name: "Road Widening PRJ20250002",
				owner_dept_cd: "RNB",
				division_cd: "Div II",
				project_start_date: "2025-09-15",
				project_end_date: "2026-06-30",
				project_awarded_to: "RNB"
			}
		};

		const projectId = getQueryParam("projectId");
		if (projectId && dummyProjects[projectId]) {
			const data = dummyProjects[projectId];
			document.querySelector('input[name="project_name"]').value = data.project_name;
			document.querySelector('select[name="owner_dept_cd"]').value = data.owner_dept_cd;
			document.querySelector('select[name="division_cd"]').value = data.division_cd;
			document.querySelector('input[name="project_start_date"]').value = data.project_start_date;
			document.querySelector('input[name="project_end_date"]').value = data.project_end_date;
			document.querySelector('select[name="project_awarded_to"]').value = data.project_awarded_to;
		}
	</script>
</body>

</html>