<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Asset Pool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<div class="container py-5">
  <h2 class="text-center mb-4">Create Pool of Assets</h2>

  <!-- Form Entry Area -->
  <div class="row g-3 align-items-end mb-4">
    <div class="col-md-6">
      <label class="form-label">Proposed Road Name</label>
      <input type="text" id="poolRoadName" class="form-control" />
    </div>

    <div class="col-md-6">
      <label class="form-label">Proposed Road Length (km)</label>
      <input type="number" id="poolRoadLength" step="0.01" class="form-control" />
    </div>

    <!-- Culverts -->
    <div class="col-md-4">
      <label class="form-label">Proposed Culverts</label>
      <select id="poolCulverts" class="form-select" multiple>
        <option value="Culvert A">Culvert A</option>
        <option value="Culvert B">Culvert B</option>
        <option value="Culvert C">Culvert C</option>
      </select>
    </div>

    <!-- Bridges -->
    <div class="col-md-4">
      <label class="form-label">Proposed Bridges</label>
      <select id="poolBridges" class="form-select" multiple>
        <option value="Bridge A">Bridge A</option>
        <option value="Bridge B">Bridge B</option>
        <option value="Bridge C">Bridge C</option>
      </select>
    </div>

    <!-- Retaining Walls -->
    <div class="col-md-4">
      <label class="form-label">Proposed Retaining Walls</label>
      <select id="poolWalls" class="form-select" multiple>
        <option value="Wall A">Wall A</option>
        <option value="Wall B">Wall B</option>
        <option value="Wall C">Wall C</option>
      </select>
    </div>

    <!-- Add Button -->
    <div class="col-md-3">
      <button type="button" id="addToPoolBtn" class="btn btn-success w-100 mt-2">➕ Add to Pool</button>
    </div>
  </div>

  <!-- Dynamic Pool Table -->
  <div class="table-responsive mb-4">
    <table class="table table-bordered" id="poolAssetTable">
      <thead class="table-light">
        <tr>
          <th>Road</th>
          <th>Length (km)</th>
          <th>Culverts</th>
          <th>Bridges</th>
          <th>Walls</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- rows added dynamically -->
      </tbody>
    </table>
  </div>

  <!-- Upload Shapefile -->
  <div class="mb-4">
    <label class="form-label">Upload Road Shapefile (.shp)</label>
    <input type="file" name="road_shapefile" class="form-control" accept=".shp" />
  </div>

  <div class="text-center">
    <a href="index.html" class="btn btn-outline-secondary">⬅ Back</a>
    <button class="btn btn-primary">Save Asset Pool</button>
  </div>
</div>

<script>
  const poolRoadName = document.getElementById("poolRoadName");
  const poolRoadLength = document.getElementById("poolRoadLength");
  const poolCulverts = document.getElementById("poolCulverts");
  const poolBridges = document.getElementById("poolBridges");
  const poolWalls = document.getElementById("poolWalls");
  const poolAssetTable = document.querySelector("#poolAssetTable tbody");

  document.getElementById("addToPoolBtn").addEventListener("click", () => {
    const road = poolRoadName.value.trim();
    const length = poolRoadLength.value.trim();
    const culverts = Array.from(poolCulverts.selectedOptions).map(opt => opt.value);
    const bridges = Array.from(poolBridges.selectedOptions).map(opt => opt.value);
    const walls = Array.from(poolWalls.selectedOptions).map(opt => opt.value);

    if (!road || !length || (culverts.length === 0 && bridges.length === 0 && walls.length === 0)) {
      alert("Please fill road name, length and at least one asset.");
      return;
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>
        <input type="hidden" name="pool_road[]" value="${road}">${road}
      </td>
      <td><input type="hidden" name="pool_length[]" value="${length}">${length}</td>
      <td>
        ${culverts.map(c => `<input type="hidden" name="pool_culverts_${road}[]" value="${c}"><span class="badge bg-info me-1">${c}</span>`).join("")}
      </td>
      <td>
        ${bridges.map(b => `<input type="hidden" name="pool_bridges_${road}[]" value="${b}"><span class="badge bg-warning text-dark me-1">${b}</span>`).join("")}
      </td>
      <td>
        ${walls.map(w => `<input type="hidden" name="pool_walls_${road}[]" value="${w}"><span class="badge bg-secondary me-1">${w}</span>`).join("")}
      </td>
      <td><button type="button" class="btn btn-sm btn-danger deleteRowBtn">Delete</button></td>
    `;

    poolAssetTable.appendChild(tr);

    // Reset inputs
    poolRoadName.value = "";
    poolRoadLength.value = "";
    poolCulverts.selectedIndex = -1;
    poolBridges.selectedIndex = -1;
    poolWalls.selectedIndex = -1;
  });

  poolAssetTable.addEventListener("click", (e) => {
    if (e.target.classList.contains("deleteRowBtn")) {
      e.target.closest("tr").remove();
    }
  });
</script>
</body>
</html>
